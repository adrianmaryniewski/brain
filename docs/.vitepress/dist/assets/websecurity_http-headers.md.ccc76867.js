import{_ as e,c as t,o as a,N as s}from"./chunks/framework.0799945b.js";const g=JSON.parse('{"title":"HTTP Headers","description":"","frontmatter":{},"headers":[],"relativePath":"websecurity/http-headers.md"}'),n={name:"websecurity/http-headers.md"},r=s(`<h1 id="http-headers" tabindex="-1">HTTP Headers <a class="header-anchor" href="#http-headers" aria-label="Permalink to &quot;HTTP Headers&quot;">​</a></h1><blockquote><p>Notes from the book &quot;Web Application Security&quot;</p></blockquote><h2 id="http-headers-in-the-context-of-security" tabindex="-1">HTTP Headers in the Context of Security <a class="header-anchor" href="#http-headers-in-the-context-of-security" aria-label="Permalink to &quot;HTTP Headers in the Context of Security&quot;">​</a></h2><p>In this chapter, we will learn about interesting HTTP headers that can help increase the security of applications. We also learned how attackers might try to bypass them. Headers are defined by providing a name and value separated by a colon. There are many different headers, and their application depends on the creativity of the application creator. The most popular ones are those responsible for authentication, caching, security, encoding, range, resource fetching, redirects, server-side actions, WebSockets, and connection management.</p><ul><li>HTTP Strict Transport Security (HSTS)</li><li>Content-Security-Policy</li><li>X-Frame-Options</li><li>X-Content-Type-Options</li><li>Referrer-Policy</li><li>Feature-Policy</li><li>Access-Control-Allow-Origin</li></ul><p>are the most popular headers related to security. Application authors and server owners can add their own, arbitrary headers, which means their number is potentially unlimited. Remember that headers are a very valuable source of information about the technologies used, software, and configuration elements. To check the current headers for a specific page, you can use the Developer Tools available in many browsers. Launching and using this tool is very simple - just start the browser, go to the page whose headers you want to see, and press the F12 key (cmd shift i on Mac) or select the tool from the VIEW › DEVELOPER › DEVELOPER TOOLS menu.</p><p><img src="https://www.dropbox.com/scl/fi/txsnphr5uj2woin9ncz2l/pb-zxGsYGB3pU.png?rlkey=xijd17d86ice4xoylxzpn2p08&amp;raw=1" alt="console-headers-1"></p><p>We go to the NETWORK tab, here again, you need to reload the page (refresh), for example by pressing the F5 key.</p><p><img src="https://www.dropbox.com/scl/fi/2ad0oqrkkek60kgrj4nza/pb-Wkexvo0kfJ.png?rlkey=1vrp47shceghd505ew86vvmzc&amp;raw=1" alt="console-headers"></p><p>At this point, we will see many different calls and loaded resources. Let&#39;s select what interests us - by selecting the given element.</p><p>The HEADERS tab in the HTTP header verification tool is most useful for verification purposes. It contains general information about</p><ul><li>the request,</li><li>the HTTP method used,</li><li>the server&#39;s return code,</li><li>the IP address with the port, and</li><li>a summary of the headers that were included in the HTTP response.</li></ul><p>Additionally, the tool also has PREVIEW, RESPONSE, COOKIES, and TIMING tabs, which respectively present a preview of the site, the full source code of the page, a summary of cookies associated with the site along with the current flags, and the performance and speed of the site.</p><h2 id="selected-http-headers-and-their-impact-on-security" tabindex="-1">Selected HTTP Headers and Their Impact on Security <a class="header-anchor" href="#selected-http-headers-and-their-impact-on-security" aria-label="Permalink to &quot;Selected HTTP Headers and Their Impact on Security&quot;">​</a></h2><h3 id="http-strict-transport-security-hsts" tabindex="-1">HTTP Strict-Transport-Security (HSTS) <a class="header-anchor" href="#http-strict-transport-security-hsts" aria-label="Permalink to &quot;HTTP Strict-Transport-Security (HSTS)&quot;">​</a></h3><p>The consequence of implementing the HSTS mechanism is to enforce the use of an encrypted HTTPS connection on the user, which ensures data security. Additionally, in the event of a certificate error, the user does not have the option to bypass the warning (Click-Through Insecurity). However, this mechanism does not protect the user on the first access to the site if it does not use the option of being on the preload list.</p><p>The HSTS header allows websites to indicate to browsers that they should always load them via the HTTPS protocol. The parameters max-age, includeSubDomains, and preload specify how long the browser should remember that the site is available only over HTTPS, whether the rule also applies to subdomains, and whether the site should be added to the HSTS Pre-Loaded List. Using the preload directive has permanent consequences, so if the site owner decides to give up HTTPS, they can do so through the <a href="https://hstspreload.org/removal/" target="_blank" rel="noreferrer">https://hstspreload.org/removal/</a> page.</p><p>The HSTS header allows websites to indicate to browsers that they should always load them via the HTTPS protocol.</p><p>Parameters:</p><ul><li>max-age,</li><li>includeSubDomains,</li><li>preload</li></ul><p>determine how long the browser should remember that the site is available only over HTTPS, whether the rule also applies to subdomains, and whether the site can be added to the HSTS Pre-Loaded List. Using the preload directive is associated with permanent consequences, and if the site owner decides to abandon it, they can do so through the <a href="https://hstspreload.org/removal/" target="_blank" rel="noreferrer">https://hstspreload.org/removal/</a> page.</p><p>Values for individual directives can be presented in a simple table:</p><table><thead><tr><th>DIRECTIVE NAME</th><th>VALUE DESCRIPTION</th><th>RECOMMENDED VALUE</th><th>DIRECTIVE TYPE</th></tr></thead><tbody><tr><td>max-age</td><td>validity time</td><td>31536000</td><td>REQUIRED</td></tr><tr><td>includeSubDomains</td><td>nd.</td><td>nd.</td><td>OPTIONAL</td></tr><tr><td>preload</td><td>nd.</td><td>nd.</td><td>OPTIONAL</td></tr></tbody></table><p>nd. means that the directive does not require any value.</p><p>The includeSubDomains directive is an important element that ensures protection against cookie leakage. If it is not set, there is a risk that the attacker will have access to cookies, even if they have the Secure attribute. To ensure full protection, the includeSubDomains directive must be active. Otherwise, there is a risk that cookies will be exposed even after displaying a warning about an invalid certificate. Therefore, it is important to make sure that the includeSubDomains directive is set to ensure full protection against cookie leakage.</p><p>An example of an HSTS header with recommended values:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">Strict-Transport-Security: max-age=31536000; includeSubDomains; preload</span></span></code></pre></div><p>To verify the current settings or the presence of HSTS for a given site, we can use the net-internals tool in the Google Chrome browser by typing chrome://net-internals/#hsts into the address bar. To ensure proper operation of the site, it should be prevented from operating on the server side via HTTP. When the user enters through an unencrypted communication channel, there should be an automatic redirect to HTTPS without initiating any HTTP communication.</p><p><img src="https://www.dropbox.com/scl/fi/809858xxs0hyfnau0ws3k/pb-t0SS4Dfp3F.png?rlkey=brya18of9wzdcollgx2cwl0do&amp;raw=1" alt="pb-Xnoyj6SRpO.png"></p><p>Strict-Transport-Security (STS) is a mechanism that allows for increased security of HTTPS connections. To implement it, you need to add appropriate rules for popular web servers.</p><ul><li>For Apache, you should set the header Header always set Strict-Transport-Security &quot;max-age=31536000; includeSubDomains; preload&quot;.</li></ul><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&lt;filter&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">	&lt;filter-name&gt;httpHeaderSecurity&lt;/filter-name&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">	&lt;filter-class&gt;org.apache.catalina.filters.HttpHeaderSecurityFilter&lt;/filter-class&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">	&lt;async-supported&gt;true&lt;/async-supported&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">	&lt;init-param&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">		&lt;param-name&gt;hstsEnabled&lt;/param-name&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">		&lt;param-value&gt;true&lt;/param-value&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">	&lt;/init-param&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">&lt;init-param&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">	&lt;param-name&gt;hstsMaxAgeSeconds&lt;/param-name&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">	&lt;param-value&gt;31536000&lt;/param-value&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">&lt;/init-param&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">&lt;init-param&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">	&lt;param-name&gt;hstsIncludeSubDomains&lt;/param-name&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">	&lt;param-value&gt;true&lt;/param-value&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">&lt;/init-param&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">&lt;init-param&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">	&lt;param-name&gt;hstsPreload&lt;/param-name&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">	&lt;param-value&gt;true&lt;/param-value&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">&lt;/init-param&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">&lt;/filter&gt;</span></span></code></pre></div><ul><li>For Nginx, you need to add the header add header Strict-Transport-Security &quot;max-age=31536000; includeSub-Domains; preload&quot; always.</li><li>For IIS:</li></ul><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">&lt;configuration&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">	&lt;system.webServer&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">		&lt;httpProtocol&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">			&lt;customHeaders&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">				&lt;add name=&quot;Strict-Transport-Security&quot; value=&quot; max-age=31536000; includeSubDomains; preload&quot; /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">			&lt;/customHeaders&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">		&lt;/httpProtocol&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">	&lt;/system.webServer&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">&lt;/configuration&gt;</span></span></code></pre></div><h3 id="referrer-policy" tabindex="-1">Referrer-Policy <a class="header-anchor" href="#referrer-policy" aria-label="Permalink to &quot;Referrer-Policy&quot;">​</a></h3><p>It specifies what information or parts of it should be sent in the Referer header in the query regarding the address from which the redirection occurred. The Referer header can be the cause of leakage of important information when the user goes to an external site. An example scenario shows what this might look like in practice. The user is on the internal company portal, where there are customer and project information. When they click on a link to a competing company, information about the address from which they were redirected leaks. Referrer-Policy specifies what information should be sent in the Referer header to prevent data leaks.</p><p>Let&#39;s start with an example HTTP request with the Referer header highlighted:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">GET /manager HTTP/1.1</span></span>
<span class="line"><span style="color:#A6ACCD;">Host: internal.sekurak.pl</span></span>
<span class="line"><span style="color:#A6ACCD;">Referer: http://sekurak.pl/teksty/</span></span></code></pre></div><p>The Referer header is often used for many purposes, such as analysis and statistics, to see where users come from, or as an additional form of protection against Cross-Site Request Forgery (CSRF) attacks. There are various parameters available for the Referrer-Policy header, such as &#39;no-referrer&#39;, &#39;no-referrer-when-downgrade&#39;, &#39;same-origin&#39;, &#39;origin&#39;, &#39;strict-origin&#39;, and &#39;strict-origin-when-cross-origin&#39;. Each has its own application and advantages.</p><p>a. no-referrer-when-downgrade - is the default setting if the policy is not defined. This means that the address of the page from which the user is redirected will be sent only when the same type of protocol is used.</p><p>b. no-referrer - means that the Referer header will not be sent.</p><p>c. origin - means sending only the origin value, i.e., the address of the page without the exact path (e.g., only the address <a href="https://sekurak.pl" target="_blank" rel="noreferrer">https://sekurak.pl</a>).</p><p>d. origin-when-cross-origin - means sending the full path (<a href="https://sekurak.pl/teksty/" target="_blank" rel="noreferrer">https://sekurak.pl/teksty/</a>) in the case of the same origin, and in other cases only the origin value (<a href="https://sekurak.pl" target="_blank" rel="noreferrer">https://sekurak.pl</a>).</p><p>e. same-origin - means sending the full path in the case of the same origin, and in other cases no data will be transmitted in the Referer header.</p><p>f. strict-origin - means sending only the origin value in the case of communication with the same protocol, and in the case of switching to less secure communication, no header will be sent.</p><p>g. strict-origin-when-cross-origin - means sending the full path in the Referer header only in queries going out to the same origin, and in other cases, the behavior is the same as for the strict-origin value.</p><p>h. unsafe-url - is a policy setting that allows displaying the full value of the address of the page from which the user was redirected when the query occurs from any type of protocol. This setting can cause the Referer value to be disclosed when switching to less secure communication (HTTPS -&gt; HTTP).</p><h3 id="x-content-type-options" tabindex="-1">X-Content-Type-Options <a class="header-anchor" href="#x-content-type-options" aria-label="Permalink to &quot;X-Content-Type-Options&quot;">​</a></h3><p>Informs the browser not to try to interpret certain resources as a different type than declared in the Content-Type header. The lack of this header can cause the browser to try to determine the format of the file on its own, which can lead to unexpected and potentially dangerous consequences. An example might be a situation where it is possible to send a file to the server, but after it is sent, the extension is removed from the file name. Adding HTML code can cause the browser to determine the file format on its own, which can allow an XSS attack to be executed.</p><p>Its recommended value is &quot;nosniff&quot;, which means that the browser should interpret files in accordance with the value of the Content-Type header. Using this header can help prevent MIME-sniffing attacks, which can be used to perform cross-site scripting attacks. Using this header can help ensure site security and protect users from potential attacks.</p><h3 id="feature-policy" tabindex="-1">Feature-Policy <a class="header-anchor" href="#feature-policy" aria-label="Permalink to &quot;Feature-Policy&quot;">​</a></h3><p>The security header feature-policy allows you to control access to browser features, such as selecting a location, using a microphone, displaying notifications, etc. This allows you to limit access to these features to specific sites, which increases the security and privacy of users.</p><h3 id="x-frame-options" tabindex="-1">X-Frame-Options <a class="header-anchor" href="#x-frame-options" aria-label="Permalink to &quot;X-Frame-Options&quot;">​</a></h3><p>The X-Frame-Options header allows you to specify whether it is possible to load a page in a frame. Its implementation increases protection against Clickjacking attacks. Three parameters are available:</p><ul><li>deny,</li><li>sameorigin,</li><li>allow-from URI.</li></ul><p>An example of an X-Frame-Options header with recommended values is X-Frame-Options: SAMEORIGIN. Currently, the Content-Security-Policy header with the frame-ancestors directive is increasingly used to limit the loading of a page in a frame, which means that X-Frame-Options will likely be replaced by it.</p><p>In order to secure access to data resources, simple IP address verification is used. The implementation of this filtering is done by checking the values of various headers, such as X-Forwarded-For, X-Forwarded-Host, X-Forwarded-IP, X-Remote-IP, X-Remote-Addr, X-Real-IP, Client-IP, X-Client-IP, X-InternalIP, x-Originating-IP, X-Originated-IP, X-Backend, X-Backend-Name, X-Backend-Host, X-Backend-Addr, X-Backend-IP, X-Backend-Server. To attempt to bypass the imposed filters, just send a simple query to the given location with the addition of one or more of the above headers.</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">GET /manager HTTP/1.1</span></span>
<span class="line"><span style="color:#A6ACCD;">Host: internal.sekurak.pl</span></span>
<span class="line"><span style="color:#A6ACCD;">X-Forwarded-For: 127.0.0.1</span></span></code></pre></div><p>Bypassing security using HTTP headers is a technique that allows you to impersonate another IP address or URL, perform an Open Redirect attack, discover server types, bypass CAPTCHA, enable developer mode, and poison access logs. This is particularly dangerous because it allows bypassing restrictions imposed in the context of access from a specific IP address, as well as sending a victim of an attack an email with a replaced link.</p><hr>`,60),o=[r];function i(l,p,c,h,d,u){return a(),t("div",null,o)}const f=e(n,[["render",i]]);export{g as __pageData,f as default};
